<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:insert="fragments/head :: common"></th:block>
    <title>회원가입</title>
</head>
<body class="ui grid">
<div class="ui container middle aligned center aligned grid" style="padding:50px 0px">
    <div class="ten wide column">
        <h2 class="ui teal image header">
            <div class="content" style="color: black">
                회원가입 정보를 입력하세요.
            </div>
        </h2>
        <form th:action="@{/users}" id="userForm" class="ui large form" th:method="POST">
            <div class="ui stacked segment">
                <div class="field">
                    <label style="float:left">이메일 주소</label>
                    <div class="ui left icon input">
                        <i class="envelope icon"></i><input type="email" name="email" placeholder="이메일 주소" required>
                    </div>
                </div>
                <div class="two fields">
                    <div class="field">
                        <label style="float:left">비밀번호</label>
                        <div class="ui left icon input">
                            <i class="lock icon"></i><input type="password" placeholder="비밀번호" name="password"
                                                            id="password" required>
                        </div>
                    </div>
                    <div class="field">
                        <label style="float:left">비밀번호 확인</label>
                        <div class="ui left icon input">
                            <i class="lock icon"></i> <input type="password" placeholder="비밀번호 확인" name="passwordCheck"
                                                             id="passwordCheck" required>
                        </div>
                    </div>
                </div>
                <div id="passwordError"></div>
                <div>

                </div>
                <div class="field">
                    <label style="float:left">닉네임</label>
                    <div class="ui left icon input">
                        <i class="user icon"></i><input type="text" placeholder="닉네임" name="nickName" required>
                    </div>
                </div>
                <div class="two fields">
                    <div class="field">
                        <button class="ui fluid large secondary submit button" type="submit" onclick="checkUserDuplication()">회원가입</button>
                    </div>
                    <div class="field">
                        <a class="ui fluid large button" style="float:right" href="/">취소</a>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

</body>
<script>
    $("#password").keyup(function () {
        if ($("#password").val().length < 4) {
            $('#passwordError').html("<p style='color:red'>비밀번호는 최소 4글자 이상 입력해주세요.</p>")
            return
        }

        $('#passwordError').html("");
    });

    //비밀번호와 비밀번호 확인이 같은지 확인
    $("#passwordCheck").keyup(function () {
        if ($("#password").val() != $("#passwordCheck").val()) {
            $('#passwordError').html("<p style='color:red'>비밀번호와 비밀번호 확인이 같지 않습니다.</p>")
            return
        }

        $('#passwordError').html("");
    });

    function checkUserDuplication() {
        $.ajax({
            success: function () {
                window.location.replace("/session");
            },
            error: function (jqXHR) {
                if (jqXHR.status === 400) {
                    alert("입력값이 올바르지 않습니다.");
                } else if (jqXHR.status === 500) {
                    alert("서버의 문제가 발생했습니다.");
                }
            }
        });
    }
</script>
</html>